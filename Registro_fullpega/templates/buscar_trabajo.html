{% extends 'Partials/_Base.html' %}
{% load bootstrap4 %}
{% load static %}
{% load poll_extras %}


<link rel="stylesheet" type="text/css" href="{% static 'assets/' %}">
<link type="text/css" href="{% static 'js/dataTables.bootstrap4.min.css' %}" rel="stylesheet">
<link type="text/css" href="{% static 'js/bootstrap.css' %}" rel="stylesheet">

{% block section_contenido %}


    <div class="row text-center">

  <h4>¡Busca una pega!</h4>

  Busca y postula a una pega para ideal para ti <hr>
    </div>

{#    <div class="container">#}
    <div class="admin-form theme-primary">

              <div class="panel heading-border panel-primary">
                <div class="panel-body bg-light">
                    <div class="section-divider mb40 " id="spy1">
                      <span>¡Busca la pega que necesitas!</span>

                    </div>
                <!-- Control buttons -->
{#<div id="myBtnContainer">#}
{#  <button class="btn active" onclick="filterSelection('all')"> Show all</button>#}
{#  <button class="btn" onclick="filterSelection('cars')"> Cars</button>#}
{#  <button class="btn" onclick="filterSelection('animals')"> Animals</button>#}
{#  <button class="btn" onclick="filterSelection('fruits')"> Fruits</button>#}
{#  <button class="btn" onclick="filterSelection('colors')"> Colors</button>#}
{#</div>#}
{##}
{#<!-- The filterable elements. Note that some have multiple class names (this can be used if they belong to multiple categories) -->#}
{#<div class="container">#}
{#  <div class="filterDiv cars">BMW</div>#}
{#  <div class="filterDiv colors fruits">Orange</div>#}
{#  <div class="filterDiv cars">Volvo</div>#}
{#  <div class="filterDiv colors">Red</div>#}
{#  <div class="filterDiv cars animals">Mustang</div>#}
{#  <div class="filterDiv colors">Blue</div>#}
{#  <div class="filterDiv animals">Cat</div>#}
{#  <div class="filterDiv animals">Dog</div>#}
{#  <div class="filterDiv fruits">Melon</div>#}
{#  <div class="filterDiv fruits animals">Kiwi</div>#}
{#  <div class="filterDiv fruits">Banana</div>#}
{#  <div class="filterDiv fruits">Lemon</div>#}
{#  <div class="filterDiv animals">Cow</div>#}
{#</div>#}
{#                <style>#}
{#                    .container {#}
{#  overflow: hidden;#}
{#}#}
{##}
{#.filterDiv {#}
{#  float: left;#}
{#  background-color: #2196F3;#}
{#  color: #ffffff;#}
{#  width: 100px;#}
{#  line-height: 100px;#}
{#  text-align: center;#}
{#  margin: 2px;#}
{#  display: none; /* Hidden by default */#}
{#}#}
{##}
{#/* The "show" class is added to the filtered elements */#}
{#.show {#}
{#  display: block;#}
{#}#}
{##}
{#/* Style the buttons */#}
{#.btn {#}
{#  border: none;#}
{#  outline: none;#}
{#  padding: 12px 16px;#}
{#  background-color: #f1f1f1;#}
{#  cursor: pointer;#}
{#}#}
{##}
{#/* Add a light grey background on mouse-over */#}
{#.btn:hover {#}
{#  background-color: #ddd;#}
{#}#}
{##}
{#/* Add a dark background to the active button */#}
{#.btn.active {#}
{#  background-color: #666;#}
{#  color: white;#}
{#}#}
{#                </style>#}
                        <div class="row">
    <div class="col-md-12">
              <div class="" id="spy2">
{#                <div class="panel-heading">#}
{#                  <div class="panel-title hidden-xs">#}
{#                    <span class="glyphicon glyphicon-tasks"></span>¡Busca una pega adecuada para ti!</div>#}
{#                </div>#}
                <div class="panel-body pn bg-light">
                  <div id="datatable2_wrapper" class=" dataTables_wrapper form-inline dt-bootstrap no-footer">
{#<table id="example" class="display table table-striped table-hover dataTable no-footer" cellspacing="0" width="100%" role="grid" aria-describedby="datatable2_info" style="width: 100%;">#}
{#    <thead>#}
{#        <tr>#}
{#            <th style="width: 157px;">Name</th>#}
{#            <th>Position</th>#}
{#            <th>Office</th>#}
{#            <th>Age</th>#}
{#            <th>Start date</th>#}
{#            <th>Salary</th>#}
{#        </tr>#}
{#    </thead>#}
{##}
{#    <tfoot>#}
{##}
{#        <tr>#}
{#            <th>Name</th>#}
{#            <th>Position</th>#}
{#            <th>Office</th>#}
{#            <th>Age</th>#}
{#            <th>Start date</th>#}
{#            <th>Salary</th>#}
{#        </tr>#}
{#    </tfoot>#}
{##}
{#    <tbody>#}
{#    {% for i in prueba %}#}
{#        <tr>#}
{#                        <td style="font-weight: bold;"class="sorting_1 text-center"><span class="text-center">Vacantes: {{ i.10 }}</span></br>{{ i.1 }} </td>#}
{#                        <td class="text-center">-Area: {{ i.2 }}-</br> {{ i.3 }}</td>#}
{#                        <td class="text-center">-Area: {{ i.2 }}-</br> {{ i.3 }}</td>#}
{#                        <td class="text-center">{{ i.4 }} {{ i.5 }}</td>#}
{##}
{#            <td>2011/04/25</td>#}
{#            <td>$3,120</td>#}
{#        </tr>#}
{#    {% endfor %}#}
{##}
{#    </tbody>#}
{#</table>#}
                      <table id="example" class="table table-striped table-hover dataTable no-footer" id="datatable2" cellspacing="0" width="100%" role="grid" aria-describedby="datatable2_info" style="width: 100%;">
                    <thead >
                      <tr role="row text-center"><th class="sorting_asc text-center" tabindex="0" aria-controls="datatable2" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending" style="width: 157px;">Nombre</th><th class="sorting text-center" tabindex="0" aria-controls="datatable2" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending" style="width: 236px;">Detalle</th><th class="sorting" tabindex="0" aria-controls="datatable2" rowspan="1" colspan="1" aria-label="Office: activate to sort column ascending" style="width: 83px;">Fecha</th><th class="sorting text-center" tabindex="0" aria-controls="datatable2" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending" style="width: 51px;">Comuna</th><th class="sorting text-center" tabindex="0" aria-controls="datatable2" rowspan="1" colspan="1" aria-label="Start date: activate to sort column ascending" style="width: 108px;">Pago</th> <th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label="Salary" style="width: 75px;">Imagen</th><th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label="Salary" style="width: 75px;">Accion</th></tr>
                    </thead>
                      {% if preferencias and usuario_solicitud.privilegios == 2 or usuario_solicitud.privilegios == 4 %}
                          <h5 class="text-center">¡Se han aplicado los filtros de sus preferencias!</h5>
                          {% else %}
                          <h5 class="text-center">¡Ud no tiene los <a href="{% url 'visualizar_privilegios' request.user.pk %}">Privilegios</a> para aplicar los filtros automáticos!</h5>

                      {% endif %}
                          <div class="row text-center">
                              <div class="col-md-2 text-center">
                              </div>

                              <div class="col-md-2 text-center">
                                 <h5>Comuna</h5>
                              </div>
                              <div class="col-md-2 text-center">
                                 <h5>Area</h5>
                              </div>
                              <div class="col-md-2 text-center">
                                 <h5>Minima paga</h5>
                              </div>
                              <div class="col-md-2 text-center">
                                 <h5>Maxima paga</h5>
                              </div>
                          </div>
                          <div class="row text-center">
                              <div class="col-md-2 text-center">
                              </div>

                                <div class="col-md-2 text-center">
                                    <select class ="form-control mySelect"  style="width: 15em;" id="mySelect">
                                        {% if preferencias.Comuna and usuario_solicitud.privilegios == 2 or usuario_solicitud.privilegios == 4 %}
                                            <option  style="color:darkred;"    value="{{ preferencias.Comuna.nombre }}">{{ preferencias.Comuna.nombre }}</option>
                                        {% else %}
                                            <option value="" disabled selected>Selecciona Comuna</option>
                                        {% endif %}
                                        {% for i in comunas %}
                                            <option value="{{ i }}">{{ i }}</option>
                                        {% endfor %}
                                    </select>
                                  </div>
                              <div class="col-md-2 text-center">
{#                                  adding-bottom: 1em; margin-bottom: 1em;#}
                                    <select class ="form-control mySelect" style="width: 15em;" id="mySelect2">
                                        {% if preferencias.Area and usuario_solicitud.privilegios == 2 or usuario_solicitud.privilegios == 4 %}
                                            <option  style="color:darkred;"    value="{{ preferencias.Area.Nombre }}">{{ preferencias.Area.Nombre }}</option>
                                        {% else %}
                                            <option value="" disabled selected>Selecciona Area</option>
                                                                            {% endif %}

                                        {% for i in areas %}
                                            <option value="{{ i }}">{{ i }}</option>
                                        {% endfor %}

                                    </select>
                              </div>
                              <div class="col-md-2 text-center">
                                        {% if preferencias.M_minimo and usuario_solicitud.privilegios == 2 or usuario_solicitud.privilegios == 4  %}
                                           <input class="form-control" id="counter-low" type="text" style="color:blue;width: 15em;" placeholder="{{ preferencias.M_minimo  }}" />

                                        {% else %}
                                           <input class="form-control" id="counter-low" type="text" style="width: 15em;" placeholder="Minima paga" />
                                        {% endif %}


                                  </div>
                              <div class="col-md-2 text-center">
                                        {% if preferencias.M_maximo and usuario_solicitud.privilegios == 2 or usuario_solicitud.privilegios == 4 %}
                                           <input class="form-control" id="counter-high" type="text" style="color:blue;width: 15em;" placeholder="{{ preferencias.M_maximo  }}" />

                                        {% else %}
                                           <input class="form-control" id="counter-high" type="text" style="width: 15em;" placeholder="Maxima paga" />
                                        {% endif %}
                              </div>

                          </div>


                        <hr style="padding: 0%;margin: 0.5em;">
                    <tbody>

                    {% for i in prueba %}
{#            #                          0    1       2               3      4       5               6             7      8        9#}
{#            trabajos_listos.append((i.pk,i.Nombre,i.Area.Nombre,i.Detalle,i.Fecha,i.Hora,i.Direccion.Comuna,i.Monto_pago,i.Imagen,1))#}
                  <tr role="row" class="odd text-center">
                        <td style="font-weight: bold;"class="sorting_1 text-center"><span class="text-center">Vacantes: {{ i.10 }}</span></br>{{ i.1 }} </td>
                        <td class="text-center">-Area: {{ i.2 }}-</br> {{ i.3 }}</td>
                        <td class="text-center">{{ i.4 }} </td>
                        <td>{{ i.6 }}</td>
                        <td>{{ i.7 }}</td>


                        <td style="height: 10%;height: 10;padding: 0;"><img class='img-responsive' style="width: 8em;height: 8em; border-radius: 10em;"src="/media/{{ i.8 }}"/></td>
                        {% if i.9 == 1 %}
                                                    <td><a href="" disabled class="btn btn-rounded btn-primary">¡Ya has postulado a esta pega!</a></td>

                        {% else %}
                                <td><a href="{% url 'visualizar_perfil_detalle_pega' i.0 %}" class="btn btn-rounded btn-primary">¡Revisar pega para postular!</a></td>
                        {% endif %}
                    </tr>
                    {% endfor %}

                    </tbody>
                  </table>
                  </div>
                </div>
              </div>
            </div>
        </div>

                </div>
              </div>
{#    FIN#}
    </div>


{% endblock %}
{% block scripts %}

{#<script src="{% static 'js/jquery-3.3.1.js' %}"></script>#}
<script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'js/dataTables.bootstrap4.min.js' %}"></script>

<script>
$(document).ready(function() {
    var comuna_ini = $('#mySelect').val();
    var area_ini = $('#mySelect2').val();
    {#var min_ini = $('#counter-low').val().keyup();#}
    {#var max_ini = $('#counter-high').val().keyup();#}

    var table = $('#example').DataTable({
        /* Disable initial sort */
        "order": [],
            "language": {
        "sProcessing":    "Procesando...",
        "sLengthMenu":    "Mostrar _MENU_ registros",
        "sZeroRecords":   "No se encontraron resultados",
        "sEmptyTable":    "Ningún dato disponible en esta tabla",
        "sInfo":          "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
        "sInfoEmpty":     "Mostrando registros del 0 al 0 de un total de 0 registros",
        "sInfoFiltered":  "(filtrado de un total de _MAX_ registros)",
        "sInfoPostFix":   "",
        "sSearch":        "Buscar:",
        "sUrl":           "",
        "sInfoThousands":  ",",
        "sLoadingRecords": "Cargando...",
        "oPaginate": {
            "sFirst":    "Primero",
            "sLast":    "Último",
            "sNext":    "Siguiente",
            "sPrevious": "Anterior"
        },
        "oAria": {
            "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
            "sSortDescending": ": Activar para ordenar la columna de manera descendente"
        }
    }

    });

    $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
        return parseInt(data[4]) >= parseInt($('#counter-low').val() || data[4])
            && parseInt(data[4]) <= parseInt($('#counter-high').val() || data[4])
    });
    {% if usuario_solicitud.privilegios == 2 or usuario_solicitud.privilegios == 4 %}
        {% if preferencias.Comuna and preferencias.Area %}
            table.search(comuna_ini +' '+area_ini).draw();

        {% elif preferencias.Comuna %}
            table.search(comuna_ini).draw();
        {% elif preferencias.Area %}
            table.search(area_ini).draw();


        {% endif %}
    {% endif %}

    {#$('#counter-low, #counter-high').on('keyup', table.draw);#}
    $('#counter-low, #counter-high').keyup( function() {
        {#alert("HOLA");#}
        table.draw();
    } );

    {#$.fn.dataTable.ext.search.push(#}
    {#    function( settings, data, dataIndex ) {#}
    {#        var min = parseInt( $('#min').val(), 10 );#}
    {#        var max = parseInt( $('#max').val(), 10 );#}
    {#        var age = parseFloat( data[3] ) || 0; // use data for the age column#}
    {##}
    {#        if ( ( isNaN( min ) && isNaN( max ) ) ||#}
    {#             ( isNaN( min ) && age <= max ) ||#}
    {#             ( min <= age   && isNaN( max ) ) ||#}
    {#             ( min <= age   && age <= max ) )#}
    {#        {#}
    {#            return true;#}
    {#        }#}
    {#        return false;#}
    {#    }#}
    {#);#}
    {#$('#min, #max').keyup( function() {#}
    {#    table.draw();#}
    $('#mySelect').on('change',function(){
        var selectedValue = $(this).val();
        {#table.fnFilter("^"+selectedValue+"$", 3, true); //Exact value, column, reg#}
        var filter_value = $('.dataTables_filter input').val();
        filter_value= filter_value.replace('{{ preferencias.Comuna.nombre }}','');

        {% for i in comunas %}
        filter_value= filter_value.replace('{{ i }}','');
        {% endfor %}

        table.search(filter_value+' '+selectedValue).draw();
    });
    $('#mySelect2').on('change',function(){
        var selectedValue = $(this).val();
        var ret = "data-123".replace('ata-','');

        {#alert(ret);#}
        var filter_value = $('.dataTables_filter input').val();
        filter_value= filter_value.replace('{{ preferencias.Area.Nombre }}','');

        {% for i in areas %}
        filter_value= filter_value.replace('{{ i }}','');
        {% endfor %}
        {#table.fnFilter("^"+selectedValue+"$", 3, true); //Exact value, column, reg#}
        table.search(filter_value+' '+selectedValue).draw();
    });
    });

    {#$("#example tbody td").each(function (i) {#}
    {#    console.log(i);#}
    {#    var select = $('<select><option value=""></option></select>')#}
    {#        .appendTo($(this).empty())#}
    {#        .on('change', function () {#}
    {#            table.column(i)#}
    {#                .search($(this).val())#}
    {#                .draw();#}
    {#        });#}
    {#         table.column( i ).data().unique().sort().each( function ( d, j ) {#}
    {#        select.append( '<option value="'+d+'">'+d+'</option>' )#}
    {#    } );#}




        </script>

{#$(document).ready(function() {#}
{#    var table = $('#example').DataTable();#}

{#    $("#example tfoot th").each( function ( i ) {#}
{#        var select = $('<select><option value=""></option></select>')#}
{#            .appendTo( $(this).empty() )#}
{#            .on( 'change', function () {#}
{#                table.column( i )#}
{#                    .search( $(this).val() )#}
{#                    .draw();#}
{#            } );#}
{##}
{#        table.column( i ).data().unique().sort().each( function ( d, j ) {#}
{#            select.append( '<option value="'+d+'">'+d+'</option>' )#}
{#        } );#}
{#    } );#}
{#} );#}
{#    <script>#}
{#    filterSelection("all")#}
{#function filterSelection(c) {#}
{#  var x, i;#}
{#  x = document.getElementsByClassName("filterDiv");#}
{#  if (c == "all") c = "";#}
{#  // Add the "show" class (display:block) to the filtered elements, and remove the "show" class from the elements that are not selected#}
{#  for (i = 0; i < x.length; i++) {#}
{#    w3RemoveClass(x[i], "show");#}
{#    if (x[i].className.indexOf(c) > -1) w3AddClass(x[i], "show");#}
{#  }#}
{#}#}
{##}
{#// Show filtered elements#}
{#function w3AddClass(element, name) {#}
{#  var i, arr1, arr2;#}
{#  arr1 = element.className.split(" ");#}
{#  arr2 = name.split(" ");#}
{#  for (i = 0; i < arr2.length; i++) {#}
{#    if (arr1.indexOf(arr2[i]) == -1) {#}
{#      element.className += " " + arr2[i];#}
{#    }#}
{#  }#}
{#}#}
{##}
{#// Hide elements that are not selected#}
{#function w3RemoveClass(element, name) {#}
{#  var i, arr1, arr2;#}
{#  arr1 = element.className.split(" ");#}
{#  arr2 = name.split(" ");#}
{#  for (i = 0; i < arr2.length; i++) {#}
{#    while (arr1.indexOf(arr2[i]) > -1) {#}
{#      arr1.splice(arr1.indexOf(arr2[i]), 1);#}
{#    }#}
{#  }#}
{#  element.className = arr1.join(" ");#}
{#}#}
{##}
{#// Add active class to the current control button (highlight it)#}
{#var btnContainer = document.getElementById("myBtnContainer");#}
{#var btns = btnContainer.getElementsByClassName("btn");#}
{#for (var i = 0; i < btns.length; i++) {#}
{#  btns[i].addEventListener("click", function() {#}
{#    var current = document.getElementsByClassName("active");#}
{#    current[0].className = current[0].className.replace(" active", "");#}
{#    this.className += " active";#}
{#  });#}
{#}#}
{#    </script>#}
{##}
{#<script>#}
{#    $(document).ready(function() {#}
{#        $('#example').DataTable();#}
{#    } );#}
{#</script>#}
{% endblock %}